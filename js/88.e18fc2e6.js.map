{"version":3,"file":"js/88.e18fc2e6.js","mappings":"sOACA,MAAMA,EAAa,CACjBC,MAAO,aAEF,SAASC,EAAOC,EAAMC,EAAQC,EAAQC,EAAQC,EAAOC,GAC1D,MAAMC,EAA6B,KAC7BC,EAAsB,KAC5B,OAAO,WAAc,QAAoB,MAAOV,EAAY,CAACI,EAAO,KAAOA,EAAO,IAAK,QAAoB,KAAM,KAAM,QAAS,KAAK,QAAaM,EAAqB,CACrKC,KAAMJ,EAAMK,WACZC,MAAO,CACL,MAAS,QAEV,CACDC,SAAS,SAAS,IAAM,EAAC,QAAaL,EAA4B,CAChEM,KAAM,KACNC,MAAO,UACL,QAAaP,EAA4B,CAC3CM,KAAM,QACNC,MAAO,OACPC,SAAU,QAEZC,EAAG,GACF,EAAG,CAAC,UACT,C,6ECdA,GACEC,KAAM,aACN,IAAAR,GACE,MAAO,CACLS,UAAW,GACXR,WAAY,GAEhB,EACAS,SAAU,KACL,QAAW,CAAC,iBAEjBC,QAAS,CACP,mBAAMC,CAAcC,EAAKC,EAAU,CAAC,GAG9BC,KAAKC,cAEPF,EAAQG,QAAU,IACbH,EAAQG,QACX,cAAiB,SAASF,KAAKC,eAGjCF,EAAQE,YAAc,WAExB,MAAME,QAAiBC,MAAMN,EAAKC,GAClC,GAAwB,MAApBI,EAASE,OAIX,MAFAL,KAAKM,SAASC,MAAM,gBACpBP,KAAKQ,QAAQC,KAAK,eACZ,IAAIC,MAAM,gBAElB,OAAOP,CACT,EACA,QAAAQ,CAAS1B,GACP,IAAIC,EAAa,GACb0B,EAAQ,IAAIC,IAehB,OAdA5B,EAAK6B,SAAQC,IACPA,EAAKC,UAAUC,UACjBL,EAAMM,IAAIH,EAAKC,SAASC,SAC1B,IAEFL,EAAME,SAAQK,IACZ,IAAIC,EAASnC,EAAKoC,QAAON,GAAQA,EAAKC,UAAUC,WAAaE,IACzDG,EAAQF,EAAOG,OACnBrC,EAAWuB,KAAK,CACdU,KACAG,QACArC,KAAMmC,GACN,IAEGlC,CACT,GAEF,OAAAsC,GACExB,KAAKH,cAAc,oBAAqB,CACtC4B,OAAQ,QACPC,MAAKvB,GAAYA,EAASwB,SAAQD,MAAKE,IACxC,GAAc,QAAVA,EAGF,OAFA5B,KAAK6B,kBAAmB,EAEjB7B,KAAKH,cAAc,mBAAoB,CAC5C4B,OAAQ,QAEL,GAAc,yBAAVG,EACT,OAAO5B,KAAKH,cAAc,mBAAoB,CAC5C4B,OAAQ,QAGV,MAAM,IAAIf,MAAM,eAClB,IACCgB,MAAKvB,GAAYA,EAAS2B,SAAQJ,MAAKE,IACxC5B,KAAKN,UAAYkC,EACjB5B,KAAKd,WAAac,KAAKW,SAASiB,EAAO,IACtCG,OAAMC,IACa,iBAAhBA,EAAIC,SACNjC,KAAKM,SAASC,MAAM,kBACtB,GAEJ,G,UChFF,MAAM2B,GAA2B,OAAgB,EAAQ,CAAC,CAAC,SAAS1D,KAEpE,O","sources":["webpack://sanyue_imghub/./src/views/UserConfig.vue?d0df","webpack://sanyue_imghub/./src/views/UserConfig.vue","webpack://sanyue_imghub/./src/views/UserConfig.vue?5dc9"],"sourcesContent":["import { createElementVNode as _createElementVNode, resolveComponent as _resolveComponent, createVNode as _createVNode, withCtx as _withCtx, openBlock as _openBlock, createElementBlock as _createElementBlock } from \"vue\";\nconst _hoisted_1 = {\n  class: \"container\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_el_table_column = _resolveComponent(\"el-table-column\");\n  const _component_el_table = _resolveComponent(\"el-table\");\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_cache[0] || (_cache[0] = _createElementVNode(\"h1\", null, \"用户管理\", -1)), _createVNode(_component_el_table, {\n    data: $data.dealedData,\n    style: {\n      \"width\": \"90%\"\n    }\n  }, {\n    default: _withCtx(() => [_createVNode(_component_el_table_column, {\n      prop: \"ip\",\n      label: \"IP地址\"\n    }), _createVNode(_component_el_table_column, {\n      prop: \"count\",\n      label: \"上传次数\",\n      sortable: \"\"\n    })]),\n    _: 1\n  }, 8, [\"data\"])]);\n}","import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.set.difference.v2.js\";\nimport \"core-js/modules/es.set.intersection.v2.js\";\nimport \"core-js/modules/es.set.is-disjoint-from.v2.js\";\nimport \"core-js/modules/es.set.is-subset-of.v2.js\";\nimport \"core-js/modules/es.set.is-superset-of.v2.js\";\nimport \"core-js/modules/es.set.symmetric-difference.v2.js\";\nimport \"core-js/modules/es.set.union.v2.js\";\nimport { mapGetters } from 'vuex';\nexport default {\n  name: 'UserConfig',\n  data() {\n    return {\n      tableData: [],\n      dealedData: [] // 根据IP地址处理后的数据，格式为 {ip, count, [data]}\n    };\n  },\n  computed: {\n    ...mapGetters(['credentials'])\n  },\n  methods: {\n    async fetchWithAuth(url, options = {}) {\n      // 开发环境, url 前面加上 /api\n      // url = `/api${url}`;\n      if (this.credentials) {\n        // 设置 Authorization 头\n        options.headers = {\n          ...options.headers,\n          'Authorization': `Basic ${this.credentials}`\n        };\n        // 确保包含凭据，如 cookies\n        options.credentials = 'include';\n      }\n      const response = await fetch(url, options);\n      if (response.status === 401) {\n        // Redirect to the login page if a 401 Unauthorized is returned\n        this.$message.error('认证状态错误，请重新登录');\n        this.$router.push('/adminLogin');\n        throw new Error('Unauthorized');\n      }\n      return response;\n    },\n    dealByIP(data) {\n      let dealedData = [];\n      let ipSet = new Set();\n      data.forEach(item => {\n        if (item.metadata?.UploadIP) {\n          ipSet.add(item.metadata.UploadIP);\n        }\n      });\n      ipSet.forEach(ip => {\n        let ipData = data.filter(item => item.metadata?.UploadIP === ip);\n        let count = ipData.length;\n        dealedData.push({\n          ip,\n          count,\n          data: ipData\n        });\n      });\n      return dealedData;\n    }\n  },\n  mounted() {\n    this.fetchWithAuth(\"/api/manage/check\", {\n      method: 'GET'\n    }).then(response => response.text()).then(result => {\n      if (result == \"true\") {\n        this.showLogoutButton = true;\n        // 在 check 成功后再执行 list 的 fetch 请求\n        return this.fetchWithAuth(\"/api/manage/list\", {\n          method: 'GET'\n        });\n      } else if (result == \"Not using basic auth.\") {\n        return this.fetchWithAuth(\"/api/manage/list\", {\n          method: 'GET'\n        });\n      } else {\n        throw new Error('Unauthorized');\n      }\n    }).then(response => response.json()).then(result => {\n      this.tableData = result;\n      this.dealedData = this.dealByIP(result); // 根据IP地址处理数据\n    }).catch(err => {\n      if (err.message !== 'Unauthorized') {\n        this.$message.error('同步数据时出错，请检查网络连接');\n      }\n    });\n  }\n};","/* unplugin-vue-components disabled */import { render } from \"./UserConfig.vue?vue&type=template&id=55aec865\"\nimport script from \"./UserConfig.vue?vue&type=script&lang=js\"\nexport * from \"./UserConfig.vue?vue&type=script&lang=js\"\n\nimport \"./UserConfig.vue?vue&type=style&index=0&id=55aec865&lang=css\"\n\nimport exportComponent from \"../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__"],"names":["_hoisted_1","class","render","_ctx","_cache","$props","$setup","$data","$options","_component_el_table_column","_component_el_table","data","dealedData","style","default","prop","label","sortable","_","name","tableData","computed","methods","fetchWithAuth","url","options","this","credentials","headers","response","fetch","status","$message","error","$router","push","Error","dealByIP","ipSet","Set","forEach","item","metadata","UploadIP","add","ip","ipData","filter","count","length","mounted","method","then","text","result","showLogoutButton","json","catch","err","message","__exports__"],"sourceRoot":""}